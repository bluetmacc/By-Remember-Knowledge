## volatile的作用

- 在并发编程中保证了共享变量的可见性。(可见性:当一个线程修改了一个共享变量，另外一个线程可以立即读到这个修改的值。)

###### 线程对变量的所有操作都必须在线程自己的工作内存中完成，而不能直接读取主存中的变量，这是JMM的规定。所以每个线程都会有自己的工作内存，工作内存中存放了共享变量的副本。而正是因为这样，才造成了可见性的问题。

###### 如果volatile使用恰当的话，它比Synchronized的使用成本和执行成本更低，因为它不会引入线程上下文切换的额外调度。

## volatile的特性
- 可见性：对一个volatile变量的读，总是能看到对这个volatile变量最后的写入
- 原子性：对任意单个volatile变量的读/写具有原子性


## volatile写读的内存语义

- 写：当写一个volatile变量时，JMM会把该线程对应的本地内存中的共享变量值刷新到主内存。
- 读：当读一个volatile变量时，JMM会把该线程对应的本地内存中的共享变量置为无效。线程接下来会从竹内中读取共享变量

## 保证可见性

- 写：写屏障保证在该屏障之前的，对共享变量的改动，都同步到主内存中。
- 读：读屏障保证在该屏障之后的，对共享变量的读取，加载的都是主内存中的最新值。

## 保证有序性

- 写：写屏障会确保指令重排序时，volatile写之前的读写操作不会跑到后面。
- 读：读屏障会确保指令重排序时，volatile读之后的任何操作不会跑到前面。

